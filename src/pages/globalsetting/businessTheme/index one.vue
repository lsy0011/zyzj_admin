<template>
    <div class='businessTheme'>
        <!-- <h5>ä¸šåŠ¡ä¸»é¢˜</h5> -->
        <div class="i-layout-page-header">
            <PageHeader title="å…¨å±€è®¾ç½®" content="æ§ä»¶æƒé™å­—å…¸" hidden-breadcrumb />
        </div>
        <div class="theme_box">
            <Card dis-hover>
                <template #title>
                    å‘½åè¯´æ˜ï¼šxx _ xxxx : 'æ¨¡å—åˆ†ç»„å­—æ¯ç®€ç§° ( åˆ†ç»„ä¾æ® ä¾‹å¦‚ï¼šæ‰€å¤„ä½ç½® )' _ 'ç›¸å…³æ§ä»¶åç§°å­—æ¯ç®€å†™'ï¼›å…¨å±€æ§åˆ¶å¼€å…³å·²'APP_' å‘½åå¼€å¤´ï¼Œå†…éƒ¨é¡µé¢æ§ä»¶ä»¥'zy_'å‘½åå¼€å¤´
                    <Poptip title="å¼€å…³è¯´æ˜" placement="bottom">
                        <template #content>
                            <tbody>

                                <tr v-for="(item, key, index) in contentText" :key="index">{{ key }}: {{ item }}
                                </tr>

                                <!-- <tr> zy_yybjï¼šåŒ»è¯ä¿å¥</tr>
                                <tr> zy_ylfwï¼šåŒ»ç–—æœåŠ¡</tr>
                                <tr> zy_yzpï¼šç›ŠåŠ©æ‹</tr>
                                <tr> zy_syscï¼šå–„æ„å•†åŸ</tr>
                                <tr> zy_gafwï¼šå…³çˆ±æœåŠ¡</tr>
                                <tr> zy_pltjï¼šè¯„è®ºæ·»åŠ </tr>
                                <tr> zy_plzsï¼šè¯„è®ºå±•ç¤º</tr>
                                <tr> zy_hzdwï¼šåˆä½œå•ä½</tr>
                                <tr> zy_fwdtï¼šæœåŠ¡å¤§å…</tr>
                                <tr> zy_chlbï¼šè¶…æƒ ç¤¼åŒ…</tr>
                                <tr> zy_zygcï¼šåŠ©å‹å¹¿åœº</tr>
                                <tr> zy_qzzwï¼šæ±‚èŒèŒä½</tr>
                                <tr> zy_fljï¼šç¦åˆ©é‡‘</tr>
                                <tr> zy_flwzï¼šç¦åˆ©ç‰©èµ„</tr>
                                <tr> zy_qtflï¼šå…¶ä»–ç¦åˆ©</tr>
                                <tr> zy_DefRoleï¼šé»˜è®¤è§’è‰²</tr>

                                <tr> zy_hdaxï¼šè·å¾—çˆ±å¿ƒ</tr>
                                <tr> zy_kjyeï¼šå¡é‡‘ä½™é¢</tr>
                                <tr> zy_qbyeï¼šé’±åŒ…ä½™é¢</tr>
                                <tr> zy_qgjxï¼šå‹¤å·¥ä¿­å­¦</tr>
                                <tr> zy_qybtï¼šæƒç›Šè¡¥è´´</tr> -->

                            </tbody>
                        </template>
                        <Icon type="md-help-circle" />
                    </Poptip>
                </template>
                <template #extra>
                    <a size="small" href="javescript:;" @click.prevent="addType = 'right'; modal = true;">æ·»åŠ </a>
                </template>

                <Grid border hover :square="true" padding="0">

                    <GridItem v-for="(item, index) in data" :key="index" style="height: auto;width: 30%;"
                        v-show="index == 1">
                        <div class="card_main_box">
                            <div class="main_box_line" v-bg-color="'#ffd'">
                                <div v-width="'22%'">key</div>
                                <div v-width="'52%'">åç§°</div>
                                <div v-width="'26%'">ç±»å‹</div>
                            </div>
                            <div class="main_box_line" v-for="(itm, indx) in item.children" :key="indx">
                                <div v-width="'22%'">
                                    <strong v-width="80">{{ itm.key }}</strong>
                                </div>
                                <div v-width="'52%'">
                                    <strong v-width="80">{{ contentText[itm.key] }}</strong>
                                </div>
                                <div v-width="'26%'">
                                    <span v-show="itm.valueType == 'switch'">å¼€å…³</span>
                                    <span v-show="itm.valueType == 'text'">æ–‡æœ¬</span>
                                </div>
                            </div>
                        </div>
                    </GridItem>
                    <GridItem v-for="(item, index) in data" :key="index" style="height: auto;width: 17.5%;">
                        <!-- <div class="card_head_title">
                            <strong> {{ item.title }}</strong>
                            <span v-if="index > 1" v-color="'#fa0'"> ( ä¼˜å…ˆçº§é«˜äºAPPå…¨ç«¯' ) </span>
                        </div> -->
                        <div class="card_main_box">
                            <div class="main_box_line" v-bg-color="'#eee'">
                                <div v-width="'6%'"></div>
                                <!-- <div v-width="'20%'">key</div>
                                <div v-width="'20%'">åç§°</div>
                                <div v-width="'15%'">ç±»å‹</div> -->
                                <div v-width="'90%'">{{ item.title }}</div>
                            </div>
                            <div class="main_box_line" v-for="(itm, indx) in item.children" :key="indx">
                                <div v-width="'6%'">
                                    <Poptip confirm title="ç¡®è®¤åˆ é™¤æ­¤é¡¹å—ï¼Ÿ" @on-ok="clearItemFn(item.type, itm, index)">
                                        <!-- <Icon type="ios-close-circle-outline" color="#ed0322" />
                                        <Icon type="md-close" /> -->
                                        <Tooltip content="è¯·å…ˆå…³é—­" placement="top" :disabled="itm.value == false">
                                            <Button size="small" type="error" shape="circle" ghost icon="md-close"
                                                :disabled="itm.value == false"></Button>
                                        </Tooltip>
                                    </Poptip>
                                </div>
                                <!-- <div v-width="'20%'">
                                    <Tooltip :content="contentText[itm.key]" placement="top">
                                        <strong v-width="80">{{ itm.key }}</strong>
                                    </Tooltip>
                                </div>
                                <div v-width="'20%'">
                                    <strong v-width="80">{{ contentText[itm.key] }}</strong>
                                </div>
                                <div v-width="'15%'">
                                    <span v-show="itm.valueType == 'switch'">å¼€å…³</span>
                                    <span v-show="itm.valueType == 'text'">æ–‡æœ¬</span>
                                </div> -->
                                <div v-width="'90%'">
                                    <Switch v-if="itm.valueType == 'switch'" v-model="itm.value"
                                        @on-change=" saveFn(itm, item.type)">
                                    </Switch>
                                    <Input v-else v-model="itm.value" v-width="'100%'"></Input>
                                </div>
                            </div>
                            <!-- <div>
                                <Button icon="md-add" long
                                    @click="list.type = item.type; addType = 'table'; modal = true;">
                                    æ·»åŠ 
                                </Button>
                            </div> -->
                        </div>
                    </GridItem>
                </Grid>
            </Card>
        </div>
        <Card :dis-hover="true">
            å¤‡æ³¨ï¼šå¾®ä¿¡å°ç¨‹åºå®¡æ ¸æ–¹é¢ï¼Œå¯èƒ½éœ€è¦ä¸´æ—¶ä¸‹æ¶æŸäº›ç±»ç›®å’Œå•†å“ï¼šï¼ˆ<a href="/goodwillGoods/goodsClassify">å–„æ„å•†åŸå•†å“ç®¡ç† -- å•†å“åˆ†ç±»ç®¡ç†</a>ã€<a
                href="/healthCareGoods/goodsClassify">åŒ»è¯ä¿å¥å•†å“ç®¡ç† -- å•†å“åˆ†ç±»ç®¡ç†</a>ï¼‰ï¼Œ
            <strong>zy_DefRole</strong> çŠ¶æ€æ‰“å¼€æ—¶ä¸ºçˆ±å¿ƒäººå£«ã€å…³é—­åˆ™ä¸ºæ®‹ç–¾äººå£«ï¼›
        </Card>
        <!-- æ·»åŠ  -->
        <Modal v-model="modal" title="å¢åŠ " width="380">
            <Form :model="list" label-position="right" :label-width="100">
                <!-- 
                    <Option value="appModule">APPå…¨ç«¯ ( IOS , Android )</Option>
                    <Option value="MpWxModule">å¾®ä¿¡å°ç¨‹åº</Option>
                    <Option value="appIOS">IOSç‰ˆ</Option>
                    <Option value="appAndroid">å®‰å“ç‰ˆ</Option>
                 -->
                <FormItem label="ç”¨æˆ·ç«¯" v-if="addType == 'right'">
                    <Select v-model="list.type">
                        <Option v-for="(item, index) in typeList" :key="index" :value="item.value">{{ item.title }}
                        </Option>
                    </Select>
                </FormItem>
                <FormItem label="keyï¼š">
                    <Input v-model="list.key" placeholder="è¯·è¾“å…¥KEY"
                        @on-blur="list.key = $event.target.value.trim()"></Input>
                </FormItem>
                <FormItem label="å†…å®¹ç±»å‹ï¼š">
                    <RadioGroup v-model="valueType">
                        <Radio label="switch">
                            <span>å¼€å…³</span>
                        </Radio>
                        <Radio label="text">
                            <span>æ–‡æœ¬</span>
                        </Radio>
                    </RadioGroup>
                </FormItem>
                <FormItem label="å†…å®¹ï¼š">
                    <Switch v-if="valueType == 'switch'" v-model="list.value"></Switch>
                    <Input v-else v-model="list.value" placeholder="è¯·è¾“å…¥å†…å®¹"> </Input>
                </FormItem>
            </Form>
            <template #footer>
                <Button type="primary" @click="saveFn(list, list.type)" :disabled="!list.type">ä¿å­˜</Button>
                <Button @click="modal = false; list = {}">å–æ¶ˆ</Button>
            </template>
        </Modal>
    </div>
</template>
<script>
import {
    getSysSettingReadApi,
    postSysSettingSaveApi,
    postSysSettingClearApi,
} from '@/api/account'
export default {
    name: 'businessTheme',
    data() {
        return {
            modal: false,
            typeList: [
                { title: 'å¾®ä¿¡å°ç¨‹åº', value: 'MpWxModule' },
                { title: 'APPå…¨ç«¯ ( IOS , Android )', value: 'appModule' },
                { title: 'IOSç‰ˆ', value: 'appIOS' },
                { title: 'Androidç‰ˆ', value: 'appAndroid' },
            ],   // ç«¯ ç±»å‹
            valueType: 'switch',   // å†…å®¹ç±»å‹
            list: {},   // å¢åŠ 
            data: [],   // æ•°æ®
            dataAll: [],
            time1: null,   // ä¿å­˜
            addType: 'table',   // æ·»åŠ æ–¹å¼

            contentText: {
                zy_yybj: "åŒ»è¯ä¿å¥",
                zy_ylfw: "åŒ»ç–—æœåŠ¡ ",
                zy_yzp: "ç›ŠåŠ©æ‹ ",
                zy_sysc: "å–„æ„å•†åŸ ",
                zy_gafw: "å…³çˆ±æœåŠ¡ ",
                zy_pltj: "è¯„è®ºæ·»åŠ  ",
                zy_plzs: "è¯„è®ºå±•ç¤º ",
                zy_hzdw: "åˆä½œå•ä½ ",
                zy_fwdt: "æœåŠ¡å¤§å… ",
                zy_chlb: "è¶…æƒ ç¤¼åŒ… ",
                zy_zygc: "åŠ©å‹å¹¿åœº ",
                zy_qzzw: "æ±‚èŒèŒä½ ",
                zy_flj: "ç¦åˆ©é‡‘ ",
                zy_flwz: "ç¦åˆ©ç‰©èµ„ ",
                zy_qtfl: "å…¶ä»–ç¦åˆ© ",
                zy_DefRole: "é»˜è®¤è§’è‰² ",
                zy_hdax: "è·å¾—çˆ±å¿ƒ ",
                zy_kjye: "å¡é‡‘ä½™é¢ ",
                zy_qbye: "é’±åŒ…ä½™é¢ ",
                zy_qgjx: "å‹¤å·¥ä¿­å­¦ ",
                zy_qybt: "æƒç›Šè¡¥è´´ ",
            },   // ç¼©å†™è¯´æ˜

            ifShow: null,

        }
    },
    created() {
        this.getDataFn();
    },
    methods: {
        // è·å–
        getDataFn() {
            this.data = [];
            this.typeList.forEach((item, index) => {
                this.getOnlyData(item, index)
            });
        },
        // è·å–æŸä¸€ä¸ª
        getOnlyData(item, index) {
            this.data[index] = { title: item.title, type: item.value };
            this.dataAll[index] = { title: item.title, type: item.value };
            getSysSettingReadApi({ type: item.value }).then(res => {
                this.data[index].children = [];
                this.dataAll[index].children = [];
                for (const key in res) {
                    if (Object.hasOwnProperty.call(res, key)) {
                        let element = res[key];
                        console.log("ğŸš€  getSysSettingReadApi  key:", key.includes('zy_'));
                        let valueType = '';
                        if (!key.includes('zy_')) {
                            if (element == 'false' || element == 'true') {
                                valueType = 'switch';
                                element = element == 'true' ? true : false;
                            } else {
                                valueType = 'text';
                                element = element;
                            }
                            this.data[index].children.push({ key: key, value: element, valueType });
                        } else {
                            if (element == 'false' || element == 'true') {
                                valueType = 'switch';
                                element = element == 'true' ? true : false;
                            } else {
                                valueType = 'text';
                                element = element;
                            }
                            this.dataAll[index].children.push({ key: key, value: element, valueType });
                        }
                    }
                };
                console.log(this.data);

                // this.globalData = uniqueKeys.filter(item => !item.includes('zy_')); //ä¸å« zy_ å­—æ®µï¼Œè¡¨ç¤ºå…¨å±€æ§ä»¶,  åŒ…æ‹¬ â€œAPP_â€
                // this.partData = uniqueKeys.filter(item => item.includes('zy_')); //å«æœ‰ zy_ å­—æ®µï¼Œè¡¨ç¤ºé¡µé¢å±€éƒ¨æ§ä»¶

                // this.tableData = JSON.parse(JSON.stringify(this.globalData))

                this.ifShow = false // ç‚¹å‡»å±•å¼€(false => true)ä¸  ç‚¹å‡»æŠ˜å (true => false)



            })
        },
        // ä¿å­˜
        saveFn(row, type = '') {
            if (this.time1) {
                clearTimeout(this.time1);
                this.time1 = null;
            }
            let data = JSON.parse(JSON.stringify(row));
            if (!data.type) {
                data.type = type;
            }
            if (data.valueType) {
                delete data.valueType;
            }
            if (data.value === undefined) {
                data.value = 'false';
            } else {
                if (typeof data.value === 'boolean') {
                    data.value = data.value.toString();
                }
            }
            let num = 0;
            this.typeList.forEach((item, index) => {
                if (item.value == type) num = index;
            })
            if (!data.key) {
                this.$Message.warning('è¯·è¡¥å……KEYå€¼')
            } else {
                this.time1 = setTimeout(() => {
                    postSysSettingSaveApi(data).then(res => {
                        this.modal = false;
                        this.getOnlyData(this.typeList[num], num);
                        this.$Message.success('æ“ä½œæˆåŠŸï¼');
                        this.list = {};
                    }).catch(err => {
                        this.$Message.error('æ“ä½œå¤±è´¥!')
                    })
                }, 500);
            }
        },
        // åˆ é™¤
        clearItemFn(type, row, index) {
            postSysSettingClearApi({ type, key: row.key }).then(res => {
                this.$Message.success('æ“ä½œæˆåŠŸï¼')
                this.getOnlyData(this.typeList[index], index)
            })
        },
    }
}
</script>
<style scoped lang='less'>
.theme_box {
    margin-top: 24px;
    margin-bottom: 12px;

    strong {
        cursor: pointer;
    }

    .card_head_title {
        padding-bottom: 10px;
        padding-left: 10px;
        box-sizing: border-box;
        border-bottom: 2px solid #ddd;
    }

    .card_main_box {
        padding-top: 20px;
        box-sizing: border-box;

        .main_box_line {
            // height: 23px;
            max-height: 44px;
            line-height: 24px;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;

            padding: 10px;
            box-sizing: border-box;
            text-align: center;
            display: flex;
            align-items: center;

            // justify-content: space-around;
            .ivu-btn-icon-only {
                width: 14px;
                height: 14px;
                padding: 0;
                font-size: 9px;
            }

            span {
                padding-right: 8px;
                box-sizing: border-box;
            }
        }
    }

}
</style>